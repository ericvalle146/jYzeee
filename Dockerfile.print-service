# ================================
# üñ®Ô∏è DOCKERFILE - PRINT SERVICE
# ================================
# Servi√ßo de impress√£o via IP

FROM node:18-alpine AS print-service

# Instalar depend√™ncias do sistema
RUN apk add --no-cache \
    cups \
    cups-client \
    curl \
    python3 \
    make \
    g++

# Configurar diret√≥rio de trabalho
WORKDIR /app

# Copiar configura√ß√£o da impressora
COPY printer.config.js ./
COPY local-printer-service/package*.json ./

# Instalar depend√™ncias do Node.js
RUN npm ci --only=production && npm cache clean --force

# Copiar c√≥digo do servi√ßo de impress√£o
COPY local-printer-service/ .

# Criar diret√≥rios necess√°rios
RUN mkdir -p /tmp/jyze-print-queue
RUN mkdir -p /var/log/cups

# Configurar permiss√µes
RUN chmod +x local-printer-service.js

# Expor porta do servi√ßo
EXPOSE 3003

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=10s --retries=3 \
    CMD curl -f http://localhost:3003/status || exit 1

# Vari√°veis de ambiente padr√£o
ENV NODE_ENV=production
ENV LOCAL_PORT=3003
ENV PRINTER_NAME=5808L-V2024

# Comando para iniciar o servi√ßo
CMD ["node", "local-printer-service.js"]
